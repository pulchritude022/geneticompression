{"version":3,"sources":["src/advanced-settings-view.js","src/app.js","src/blob-to-url.js","src/canvas-to-url.js","src/data-api.js","src/environment.js","src/image-selection.js","src/main-view.js","src/main.js","src/phenotype.js","src/population-view.js","src/resources/index.js","src/messages.js"],"names":["AdvancedSettingsView","api","App","configureRouter","config","router","title","map","route","moduleId","name","BlobToUrlValueConverter","toView","blob","URL","createObjectURL","CanvasToUrlValueConverter","canvas","toDataURL","INITIAL_POP_COUNT","sourceImageData","phenotypes","i","pheno","updateCanvas","push","mutationRate","DataApi","sourceLoaded","sourceImgUrl","loadSourceImg","img","console","log","sourceCanvas","document","createElement","width","height","tempImage","Image","src","onload","getContext","drawImage","Array","from","getImageData","data","evaluatePhenotypes","getPhenotypes","length","forEach","currentValue","index","array","comparePixels","debug","testing","ImageSelection","ea","onFilesSelected","event","target","files","publish","onStart","MainView","noImageMessage","created","population","configure","aurelia","use","standardConfiguration","feature","developmentLogging","plugin","start","then","setRoot","math","OP_VAL","OP_X","OP_Y","OP_ADD","OP_SUB","OP_MUL","OP_DIV","CHILD_MAP","Phenotype","treeR","Node","children","treeG","treeB","nodeR","_getRandomEquation","nodeG","nodeB","match","numOps","rootNode","_getRandomConstNode","_getRandomOperatorNode","nodes","filter","node","isSymbolNode","isConstantNode","replacedNode","pickRandom","transform","path","parent","equals","VALUE_WEIGHT","CONST_WEIGHT","Math","random","X_WEIGHT","Y_WEIGHT","expression","SymbolNode","MAX_CONST","ConstantNode","round","a","b","weightedOperations","w","args","x","FunctionNode","_getRandomFunctionNode","_getRandomNumber","max","floor","dumpFormula","R","G","B","A","getRGBAForumlas","str","toString","ctx","imageData","eqR","compile","eqG","eqB","y","scope","offset","eval","putImageData","getCanvas","sourceData","ctx1","matrix","ctx2","subtract","dotMultiply","sum","size","get","operation","op","getFormula","PopulationView","subscribe","msg","MsgNewSourceImage","newImageFile","image","MsgSourceImageLoaded","MsgIterate","MsgPopSizeChanged","newPopSize","MsgPopUpdated"],"mappings":"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","file":"app-bundle.js","sourcesContent":["/**\n * Created by amccollough on 5/25/17.\n */\nimport {inject} from 'aurelia-framework'\nimport {DataApi} from './data-api'\n\n@inject(DataApi)\nexport class AdvancedSettingsView {\n  constructor (api) {\n    this.api = api;\n  }\n}\n","\nimport {inject} from 'aurelia-framework'\nimport {DataApi} from './data-api'\n\n@inject(DataApi)\nexport class App {\n  constructor (api) {\n    this.api = api;\n  }\n\n  configureRouter(config, router){\n    config.title = 'Select an Image';\n    config.map([\n      {route: '',           moduleId: 'main-view'},\n      {route: 'population', moduleId: 'population-view',        name: 'population'},\n      {route: 'settings',   moduleId: 'advanced-settings-view', name: 'advanced'}\n    ]);\n\n    this.router = router;\n  }\n}\n","/**\r\n * Created by amccollough on 5/23/17.\r\n */\r\nexport class BlobToUrlValueConverter {\r\n    toView(blob) {\r\n        return URL.createObjectURL(blob);\r\n    }\r\n}\r\n","/**\r\n * Created by amccollough on 5/23/17.\r\n */\r\nexport class CanvasToUrlValueConverter {\r\n    toView(canvas) {\r\n        return canvas.toDataURL();\r\n    }\r\n}","/**\n * Created by amccollough on 5/25/17.\n */\nimport {Phenotype} from './phenotype'\n\nconst INITIAL_POP_COUNT = 12;\n\nlet sourceImageData = [];\nlet phenotypes = [];\n\nfor (let i=0; i < INITIAL_POP_COUNT; i++) {\n  let pheno = new Phenotype(300,300);\n  pheno.updateCanvas();\n  phenotypes.push(pheno)\n}\n\nlet mutationRate = 5;\n\n\nexport class DataApi {\n  constructor () {\n    this.sourceLoaded = false;\n    this.sourceImgUrl = \"\";\n  }\n\n  loadSourceImg (img){\n    if (img) {\n      console.log(URL.createObjectURL(img));\n      this.sourceImgUrl = URL.createObjectURL(img);\n      this.sourceLoaded = true;\n\n      // Save off the Image data by transforming into a temporary canvas\n      let sourceCanvas = document.createElement(\"canvas\");\n      sourceCanvas.width = 300;\n      sourceCanvas.height = 300;\n      let tempImage = new Image (300,300);\n      tempImage.src = this.sourceImgUrl;\n      tempImage.onload = () => {\n        console.log(\"Loaded!\");\n        sourceCanvas.getContext('2d').drawImage(tempImage, 0, 0);\n        sourceImageData = Array.from (sourceCanvas.getContext('2d').getImageData(0,0,300,300).data);\n        this.evaluatePhenotypes();\n      };\n\n    }\n    else {\n      this.sourceImgUrl = \"\";\n      this.sourceLoaded = false;\n    }\n  }\n\n  getPhenotypes () {\n    return phenotypes;\n  }\n\n  evaluatePhenotypes () {\n    if (sourceImageData.length > 0){\n      phenotypes.forEach((currentValue, index, array) => {\n        console.log(index, currentValue.comparePixels(sourceImageData));\n      })\n    }\n  }\n}\n\n","export default {\n  debug: true,\n  testing: true\n};\n","/**\n * Created by amccollough on 5/25/17.\n */\nimport {inject} from 'aurelia-framework'\nimport {EventAggregator} from 'aurelia-event-aggregator'\nimport {MsgNewSourceImage} from './messages'\nimport {DataApi} from './data-api'\n\n@inject(DataApi, EventAggregator)\nexport class ImageSelection {\n  constructor (api, ea) {\n    this.api = api;\n    this.ea = ea;\n  }\n\n  onFilesSelected (event) {\n    let img = event.target.files[0];\n    this.api.loadSourceImg (img);\n    this.ea.publish (new MsgNewSourceImage (img));\n  }\n\n  onStart () {\n    console.log (\"Started!\");\n  }\n\n}\n","/**\n * Created by amccollough on 5/25/17.\n */\nimport {inject} from 'aurelia-framework'\nimport {DataApi} from './data-api'\n\n@inject(DataApi)\nexport class MainView {\n  constructor (api) {\n    this.api = api;\n    this.noImageMessage = \"Please select a source image.\"\n  }\n\n  created () {\n    this.population = this.api.getPhenotypes();\n  }\n}\n","import environment from './environment';\n\nexport function configure(aurelia) {\n  aurelia.use\n    .standardConfiguration()\n    .feature('resources');\n\n  if (environment.debug) {\n    aurelia.use.developmentLogging();\n  }\n\n  if (environment.testing) {\n    aurelia.use.plugin('aurelia-testing');\n  }\n\n  aurelia.start().then(() => aurelia.setRoot());\n}\n","/**\n * Created by amccollough on 5/23/17.\n */\nlet math = require('mathjs');\n\nconst OP_VAL = 0;\nconst OP_X = 1;\nconst OP_Y = 2;\nconst OP_ADD = 3;\nconst OP_SUB = 4;\nconst OP_MUL = 5;\nconst OP_DIV = 6;\n\nlet CHILD_MAP = {};\nCHILD_MAP[OP_VAL] = 0;\nCHILD_MAP[OP_X] = 0;\nCHILD_MAP[OP_Y] = 0;\nCHILD_MAP[OP_ADD] = 2;\nCHILD_MAP[OP_SUB] = 2;\nCHILD_MAP[OP_MUL] = 2;\nCHILD_MAP[OP_DIV] = 2;\n\nexport class Phenotype {\n    constructor (width, height) {\n        this.treeR = new Node(OP_ADD);\n        this.treeR.children.push(new Node(OP_X));\n        this.treeR.children.push(new Node(OP_MUL));\n        this.treeR.children[1].children.push(new Node(OP_Y));\n        this.treeR.children[1].children.push(new Node(OP_VAL,1.5));\n\n        this.treeG = new Node(OP_SUB);\n        this.treeG.children.push(new Node(OP_X));\n        this.treeG.children.push(new Node(OP_Y));\n\n        this.treeB = new Node(OP_MUL);\n        this.treeB.children.push(new Node(OP_X));\n        this.treeB.children.push(new Node(OP_VAL, 2));\n\n        this.canvas = document.createElement(\"canvas\");\n\n        this.canvas.width = width;\n        this.canvas.height = height;\n\n      this.nodeR = this._getRandomEquation (0);\n      this.nodeG = this._getRandomEquation (1);\n      this.nodeB = this._getRandomEquation (1);\n\n      this.match = 0; // current match strength against source image, range 0..1\n    }\n\n    _getRandomEquation (numOps) {\n      let rootNode = this._getRandomConstNode();\n      if (numOps >= 1) {\n        rootNode = this._getRandomOperatorNode ();\n\n        for (let i = 1; i < numOps; i++) {\n          let nodes = rootNode.filter((node) => {return node.isSymbolNode || node.isConstantNode;});\n          let replacedNode = math.pickRandom(nodes);\n          rootNode.transform ((node, path, parent) => {\n            if (node.equals(replacedNode)) {\n              return this._getRandomOperatorNode ();\n            }\n            else {\n              return node;\n            }\n          });\n\n          return rootNode;\n        }\n      }\n      return rootNode;\n    }\n\n    _getRandomConstNode () {\n      const VALUE_WEIGHT = 1;\n      const CONST_WEIGHT = 1;\n      if (Math.random () < (VALUE_WEIGHT/(VALUE_WEIGHT+CONST_WEIGHT))) {\n        // Create a value node\n        const X_WEIGHT = 1;\n        const Y_WEIGHT = 1;\n        return (Math.random () < (X_WEIGHT/(X_WEIGHT+Y_WEIGHT))) ?\n          new math.expression.node.SymbolNode ('x') :\n          new math.expression.node.SymbolNode ('y');\n      }\n      else {\n        // Create a constant node using a rough approximation of a std distribution centered around 0\n        const MAX_CONST = 20;\n        return new math.expression.node.ConstantNode(math.round ((((Math.random() + Math.random() + Math.random() + Math.random()) - 2) / 2) * MAX_CONST, 2));\n      }\n    }\n\n    _getRandomOperatorNode () {\n      let a = this._getRandomConstNode ();\n      let b = this._getRandomConstNode ();\n      let weightedOperations = [\n        {w: 5, args: ['add', [a, b]] },\n        {w: 5, args: ['subtract', [a, b]] },\n        {w: 5, args: ['multiply', [a, b]] },\n        {w: 5, args: ['divide', [a, b]] },\n        {w: 3, args: ['pow', [a, b]] },\n        {w: 1, args: ['abs', [a]] },\n        {w: 2, args: ['cube', [a]] },\n        {w: 1, args: ['exp', [a]] },\n        {w: 1, args: ['log', [a, b]] },\n        {w: 1, args: ['pow', [a, b]] },\n        {w: 1, args: ['sign', [a]] },\n        {w: 2, args: ['sqrt', [a]] },\n        {w: 2, args: ['square', [a]] },\n        {w: 1, args: ['unaryMinus', [a]] },\n        {w: 2, args: ['sin', [a]] },\n        {w: 2, args: ['cos', [a]] },\n        {w: 2, args: ['tan', [a]] },\n        {w: 2, args: ['asin', [a]] },\n        {w: 2, args: ['acos', [a]] },\n        {w: 2, args: ['atan', [a]] },\n        {w: 2, args: ['sinh', [a]] },\n        {w: 2, args: ['cosh', [a]] },\n        {w: 2, args: ['tanh', [a]] },\n      ];\n      let args = math.pickRandom(weightedOperations, weightedOperations.map ((x) => {return x.w;})).args;\n      return new math.expression.node.FunctionNode(...args);\n    }\n\n    _getRandomFunctionNode () {\n      let a = this._getRandomConstNode ();\n      switch (this._getRandomNumber()) {\n\n      }\n    }\n\n    _getRandomNumber (max) {\n      max = Math.floor(max);\n      return Math.floor (Math.random () * max);\n    }\n\n    dumpFormula () {\n        let R, G, B, A;\n        [R, G, B, A] = this.getRGBAForumlas ();\n        let str = `R: ${R}, G: ${G}, B: ${B}, A: ${A}`;\n        console.log(str);\n        return str;\n    }\n\n    getRGBAForumlas () {\n        return [\n            // this.treeR.getFormula(),\n            // this.treeG.getFormula(),\n            // this.treeB.getFormula(),\n            this.nodeR.toString(),\n            this.nodeG.toString(),\n            this.nodeB.toString(),\n            \"255\"\n        ];\n    }\n\n    updateCanvas () {\n        let ctx = this.canvas.getContext(\"2d\");\n        let imageData = ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);\n\n        let R, G, B, A;\n        [R, G, B, A] = this.getRGBAForumlas ();\n        // let eqR = math.compile(R);\n        // let eqG = math.compile(G);\n        // let eqB = math.compile(B);\n        // let eqA = math.compile(A);\n        let eqR = this.nodeR.compile ();\n        let eqG = this.nodeG.compile ();\n        let eqB = this.nodeB.compile ();\n\n        for (var y = 0; y < this.canvas.height; y++)\n        {\n            for (var x = 0; x < this.canvas.width; x++)\n            {\n                let scope = {\n                    x: x,\n                    y: y\n                }\n                var offset = y * (this.canvas.width*4) + (x * 4);\n                imageData.data[offset + 0] = eqR.eval(scope);\n                imageData.data[offset + 1] = eqG.eval(scope);\n                imageData.data[offset + 2] = eqB.eval(scope);\n                imageData.data[offset + 3] = 255;\n            }\n        }\n        ctx.putImageData(imageData,0,0);\n    }\n\n    getCanvas () {\n        return this.canvas;\n    }\n\n    // return 0..1 -- 1 is perfect match, 0 is no match\n    comparePixels (sourceData) {\n        let ctx1 = math.matrix(Array.from (this.canvas.getContext(\"2d\").getImageData(0, 0, this.canvas.width, this.canvas.height).data));\n        let ctx2 = math.matrix(sourceData);\n          // console.log(`${math.subset(ctx1, math.index(math.range(80000,80008)))} ${math.subset(ctx2, math.index(math.range(80000,80016)))}`);\n        ctx1 = math.subtract(ctx1, ctx2);\n          // console.log(`${math.subset(ctx1, math.index(math.range(80000,80008)))} ${math.subset(ctx2, math.index(math.range(80000,80008)))}`);\n        ctx1 = math.dotMultiply(ctx1, ctx1);\n          // console.log(`${math.subset(ctx1, math.index(math.range(80000,80008)))} ${math.subset(ctx2, math.index(math.range(80000,80008)))}`);\n          // console.log(`${math.sum(ctx1)} ${math.size(ctx1).get([0])}`);\n        this.match = 1-((math.sum(ctx1)/math.size(ctx1).get([0]))/(255*255)) ;\n        return this.match;\n    }\n}\n\nclass Node {\n    constructor (operation, data = 0) {\n        this.op = operation;\n        this.data = data;\n        this.parent = null;\n        this.children = [];\n    }\n\n    getFormula () {\n        if (CHILD_MAP[this.op] != this.children.length) {\n            console.log(`Too many children! Op: ${this.op}, children: ${this.children.length}, desired: ${CHILD_MAP[this.op]}`);\n            return \"0\";\n        }\n\n        switch (this.op) {\n            case OP_VAL:\n                return `${this.data}`;\n            case OP_X:\n                return \"x\";\n            case OP_Y:\n                return \"y\";\n            case OP_ADD:\n                return `(${this.children[0].getFormula()}+${this.children[1].getFormula()})`;\n            case OP_SUB:\n                return `(${this.children[0].getFormula()}-${this.children[1].getFormula()})`;\n            case OP_MUL:\n                return `(${this.children[0].getFormula()}*${this.children[1].getFormula()})`;\n            case OP_DIV:\n                return `(${this.children[0].getFormula()}/${this.children[1].getFormula()})`;\n        }\n\n    }\n}\n","/**\n * Created by amccollough on 5/25/17.\n */\nimport {inject} from 'aurelia-framework'\nimport {EventAggregator} from 'aurelia-event-aggregator'\nimport {MsgSourceImageLoaded} from './messages'\nimport {DataApi} from './data-api'\n\n@inject(DataApi, EventAggregator)\nexport class PopulationView {\n  constructor (api, ea) {\n    this.api = api;\n\n    ea.subscribe (MsgSourceImageLoaded, (msg) => {\n      this.api.evaluatePhenotypes ();\n    });\n  }\n\n  created () {\n    this.population = this.api.getPhenotypes();\n  }\n}\n\n","export function configure(config) {\n  //config.globalResources([]);\n}\n","/**\n * Created by amccollough on 5/30/17.\n */\n\nexport class MsgNewSourceImage {\n  constructor (newImageFile) {\n    this.image = newImageFile;\n  }\n}\n\nexport class MsgSourceImageLoaded {}\n\nexport class MsgIterate {\n\n}\n\nexport class MsgPopSizeChanged {\n  constructor (newPopSize) {\n    this.size = newPopSize;\n  }\n}\n\nexport class MsgPopUpdated {\n\n}\n"],"sourceRoot":".."}